function updateCartList(){$.ajax({url:"/api/cart/",type:"get",success:function(e){if("/carts/checkout/"===location.pathname||"/carts/delivery/"===location.pathname)location.href="/carts/delivery/";else if("/carts/"===location.pathname)location.href="/carts/";else{var t="",r=e.cart_items;$("#cart-total-item").html(e.total_item),$("#cart-overview-total-item").html(1<e.total_item?e.total_item.toString()+" items":e.total_item.toString()+" item"),$("#mobile-cart-total-item").html(e.total_item),0===e.total_item?($("#cart-total-item").hide(),$("#mobile-cart-total-item").hide()):($("#cart-total-item").show(),$("#mobile-cart-total-item").show());for(var a=0;a<r.length;a++){var i=r[a];t+="<tr>",t+="<td>",t+='<form method="POST" id="form-update-increment-product-'+i.product.id+'" style="display: block;">',t+='<input type="hidden" name="product" value="'+i.product.id+'">',t+="</form>",t+='<form method="POST" id="form-update-decrement-product-'+i.product.id+'" style="display: none;">',t+='<input type="hidden" name="product" value="'+i.product.id+'">',t+='<input type="hidden" name="decrement" value="1">',t+="</form>",t+='<div class="row align-items-center">',t+='<div class="col-lg-2 col-xs-12 mb-25">',t+='<div class="product-increment">',t+='<div class="input-group input-number-group">',t+='<div class="input-group-button">',t+='<span class="input-number-decrement-cart" data-form="form-update-decrement-product-'+i.product.id+'"><i class="fas fa-minus"></i></span>',t+="</div>",t+='<input class="input-number" type="number" value="'+i.quantity+'" min="0" max="'+i.product.quantity+'">',t+='<div class="input-group-button">',t+='<span class="input-number-increment-cart" data-form="form-update-increment-product-'+i.product.id+'"><i class="fas fa-plus"></i></span>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</td>",t+="<td>",t+='<div class="row align-items-center">',t+='<div class="col-lg-4 col-xs-12">',i.product.logo_image&&(t+='<div class="cart-image">',t+='<img src="'+i.product.logo_image+'" alt="'+i.product.name+'" class=" img-fluid" title="'+i.product.name+'">',t+="</div>"),t+="</div>",t+='<div class="col-lg-8 col-xs-12 bag-txt">',t+="<p>"+i.product.name+"</p>",t+="</div>",t+="</td>",t+='<td class="cart-price mb-25">',t+='<div class="close">',t+='<a class="delete" href="javascript:;" data-form="form-delete-product-'+i.product.id+'"><i class="fas fa-trash-alt"></i></a>',t+='<form method="POST" id="form-delete-product-'+i.product.id+'" style="display: none;">',t+='<input type="hidden" name="product" value="'+i.product.id+'">',t+="</form>",t+="</div>",t+='<div class="total-price">',t+=parseFloat(i.product.price).toFixed(2),t+="</div>",t+="</td>",t+="</tr>"}$("#cart-content").html(t),$("#cart-price").html(parseFloat(e.subtotal).toFixed(2)),$("#cart-overview-price").html("$"+parseFloat(e.subtotal).toFixed(2)),$("#review-subtotal").html(parseFloat(e.subtotal).toFixed(2)),$("#review-total").html(parseFloat(e.total).toFixed(2)),$(".input-number-increment-cart").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();updateCart(e.serialize(),t)}),$(".input-number-decrement-cart").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();updateCart(e.serialize(),t)}),$(".delete").click(function(){var e=$("#"+$(this).attr("data-form")),t=$(this).attr("data-form").split("form-delete-product-")[1];deleteItemFromCart(e.serialize(),t)})}},error:function(e){console.log(e)}})}function deleteItemFromCart(e,t){var r=$("#product-"+t),a=$("#productModal"+t),i=$("#searchProductModal"+t);$("#free-delivery-amount-text");$.ajax({url:"/api/cart/delete/",type:"post",data:e,success:function(e){r.find(".close-wrap").hide(),r.find(".in-cart-price").hide(),r.find(".product-increment.cart-increment").hide(),a.find(".product-increment.cart-increment").hide(),i.find(".product-increment.cart-increment").hide(),updateCartList()},error:function(e){console.log(e)}})}function updateCart(e,t){var r=$("#product-"+t),a=$("#productModal"+t),i=$("#searchProductModal"+t),o=r.find("#product-component-spinner-"+t),n=r.find("#product-component-modal-spinner-"+t),c=i.find("#search-product-modal-spinner-"+t),s=$("#free-delivery-amount-text");o.show(),n.show(),c.show(),$.ajax({url:"/api/cart/update/",type:"post",data:e,success:function(e){o.hide(),n.hide(),c.hide(),"/carts/delivery/"===location.pathname?location.href="/carts/delivery/":(void 0!==e.quantity&&(r.find(".input-number").val(e.quantity),a.find(".input-number").val(e.quantity),i.find(".input-number").val(e.quantity),e.quantity<1?(r.find(".in-cart-price").hide(),r.find(".close-wrap").hide(),r.find(".product-increment.cart-increment").hide(),a.find(".product-increment.cart-increment").hide(),i.find(".product-increment.cart-increment").hide()):(r.find(".close-wrap").show(),r.find(".in-cart-price").show(),r.find(".in-cart-price").html("total: $ "+e.in_cart_price),r.find(".product-increment.cart-increment").show(),a.find(".product-increment.cart-increment").show(),i.find(".product-increment.cart-increment").show())),void 0!==e.free_delivery_amount&&(parseFloat(e.free_delivery_amount)>parseFloat(e.subtotal)?(s.show(),s.html("Buy products of $ "+e.free_delivery_amount+"or more to get free delivery")):s.hide()),"ok"!==e.message&&alert(e.message),updateCartList())},error:function(e){console.log(e)}})}function generate_error_message(e){var t=Object.keys(e);for(var r in t){var a=t[r];for(var i in e[a]){var o=e[a][i];$("#id_"+a+" > .col-md-12").append('<div class="alert alert-danger validation-error-message">'+o+"</div>"),$("#form-div_"+a).addClass("is-invalid")}}}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function csrftoken(){return $("[name=csrfmiddlewaretoken]").val()}$(document).ready(function(){$.ajaxSetup({beforeSend:function(e,t){csrfSafeMethod(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",csrftoken())}}),$(".add-to-cart").submit(function(e){e.preventDefault(),updateCart($(this).serialize(),$(this).find("input[name=product]").val())}),$(".input-number-increment").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();updateCart(e.serialize(),t)}),$(".input-number-decrement").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();updateCart(e.serialize(),t)}),$(".close-btn").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();deleteItemFromCart(e.serialize(),t)}),$(".delete").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();deleteItemFromCart(e.serialize(),t)}),$(".product-component-modal-delete").click(function(){var e=$("#"+$(this).attr("data-form")),t=e.find("input[name=product]").val();deleteItemFromCart(e.serialize(),t)}),$("#id_payment_type").change(function(){var e=$(this).val();e?"cash-on-delivery"===e||"sslcommerz"===e?($("#payment-form-wrap").hide(),$(".paypal-wrap").hide(),$("#payform-form-stripe").hide(),$("#checkout-form-confirm-order-btn").show()):"paypal"===e||"stripe"===e?($("#payment-form-wrap").show(),"paypal"===e?($("#checkout-form-confirm-order-btn").hide(),$("#payment-form-stripe").hide(),$(".paypal-wrap").show()):$(".paypal-wrap").hide(),"stripe"===e?($("#checkout-form-confirm-order-btn").hide(),$(".paypal-wrap").hide(),$("#payment-form-stripe").show()):$("#payment-form-stripe").hide()):($("#payment-form-wrap").hide(),$("#checkout-form-confirm-order-btn").hide(),$(".paypal-wrap").hide(),$("#payment-form-stripe").hide()):($("#checkout-form-confirm-order-btn").hide(),$("#payment-form-wrap").hide(),$(".paypal-wrap").hide(),$("#payment-form-stripe").hide())}),$("#btn-stripe-pay").click(function(){var t=Stripe("pk_live_51MqwKJIlhFlzqQJbMn6pgOJSr9SgaT3oDdXtWEEKkyUh8pVyrnQGaDyrpk3A2sZoLxVuZYqfwWvAfPTRCGyzcuhe00zJSDSFcD"),r=$(".loading-spinner"),e=$("#address-form"),a=e.attr("action"),i=e.serialize();r.show(),setTimeout(function(){$.ajax({type:"post",url:a,data:i,success:function(e){"success"===e.status&&t.redirectToCheckout({sessionId:$("#stripe-session-id").val()}).then(function(e){console.log(e)})},error:function(e){if(422===e.status){r.hide(),$(".validation-error-message > .col-md-12").html(null);var t=e.responseJSON;generate_error_message(t.address_form_error),generate_error_message(t.home_delivery_form_error),generate_error_message(t.schedule_form_error),generate_error_message(t.instruction_form_error)}}})})}),$("#payment-form > .paypal-wrap > form > input[name=submit]").click(function(e){e.preventDefault();var r=$(".loading-spinner"),t=$("#address-form"),a=t.attr("action"),i=t.serialize();r.show(),setTimeout(function(){$.ajax({type:"post",url:a,data:i,success:function(e){"success"===e.status&&$("#payment-form > form").submit()},error:function(e){if(422===e.status){r.hide(),$(".validation-error-message > .col-md-12").html(null);var t=e.responseJSON;generate_error_message(t.address_form_error),generate_error_message(t.instruction_form_error),generate_error_message(t.payment_form_error)}}})})}),$("#payment-credit-card").submit(function(e){e.preventDefault();var r=$(".loading-spinner"),t=$("#address-form"),a=t.attr("action"),i=t.serialize(),o=$(this).serialize();r.show(),setTimeout(function(){$.ajax({type:"post",url:a,data:i,success:function(e){"success"===e.status&&$.ajax({type:"post",url:"/api/payment/card/",data:o,success:function(e){"success"===e.status&&(location.href="/carts/paid/")},error:function(e){r.hide(),$(".validation-error-message > .col-md-12").html(null);var t=e.responseJSON;422===e.status?generate_error_message(t.errors):$("#payment-credit-card-error > .col-md-12").html('<div class="alert alert-danger validation-error-message">'+t.message+"</div>")}})},error:function(e){if(r.hide(),422===e.status){$(".validation-error-message > .col-md-12").html(null);var t=e.responseJSON;generate_error_message(t.address_form_error),generate_error_message(t.instruction_form_error),generate_error_message(t.payment_form_error)}}})})})});
